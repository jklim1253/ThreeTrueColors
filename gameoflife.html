<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>
		Game Of Life
	</title>
	<link rel="stylesheet" href="res/css/main.css">
</head>
<body>
<header>
	<a class="back" href="index.html">Game Board</a>/Game Of Life
</header>
<article>

	<div>
	<canvas id="screen" width="400" height="400">
		Your browser do not support HTML5 canvas.
	</canvas>
	</div>

</article>
<footer>
	copyright &copy; jklim.
</footer>
<script src="res/js/modernizr-custom.js"></script>
<script src="res/js/common.js"></script>
<script src="res/js/vector.js"></script>
<script>
window.addEventListener("load", eventWindowLoaded, false);

function eventWindowLoaded() {
	MainApp();
}
var Cell = function(x, y, size, life){
	this.x = x;
	this.y = y;
	this.size = size;
	this.life = life;
	this.style_death = "#eeeeee";
	this.style_alive = "#333333";
};
Cell.prototype.draw = function(context) {
	context.save();
	context.beginPath();
	context.rect(this.x,this.y,this.size,this.size);
	context.closePath();
	if (this.life) {
		context.fillStyle = this.style_alive;
	}
	else {
		context.fillStyle = this.style_death;
	}
	context.fill();
	context.restore();
};
Cell.prototype.setLife = function(life) {
	this.life = life;
};
Cell.prototype.deepCopy = function() {
	return new Cell(this.x, this.y, this.size, this.life);
}
function MainApp() {
	if (!canvasSupport) {
		return;
	}

	var canvas = document.getElementById("screen");
	var context = canvas.getContext("2d");

	var bgcolor = "rgb(100,120,200)";
	var grid = [[]];
	var size = 10;
	var row_max = parseInt(canvas.height/size);
	var col_max = parseInt(canvas.width/size);

	function initialize() {
		// make cells which fill the entire canvas.
		var count = 0;
		for (var col = 0; col < col_max; ++col) {
			var vline = [];
			for (var row = 0; row < row_max; ++row) {
				vline.push(new Cell(col*size, row*size, size, false));
				count++;
			}
			grid.push(vline);
		}
		Debugger.log("total cell is " + count);

		// make test case
		if (grid[col_max/2][row_max/2] !== undefined) {
			grid[col_max/2][row_max/2].setLife(true);
		}
		if (grid[col_max/2 + 1][row_max/2] !== undefined) {
			grid[col_max/2 + 1][row_max/2].setLife(true);
		}
		if (grid[col_max/2][row_max/2 + 1] !== undefined) {
			grid[col_max/2][row_max/2 + 1].setLife(true);
		}
	}
	function inputProcess() {
	}
	function isAlive(arr, x, y) {
		if (typeof arr === undefined) {
			alert("arr is undefined");
		}
		else {
			alert("arr type is " + typeof arr);
			alert("arr length is " + arr.length);
			alert("arr[0] length is " + arr[0].length);
		}

		var count_alive = 0;
		if (arr[x-1][y-1] !== undefined) {
			count_alive += arr[x-1][y-1].life? 1 : 0;
		}
		if (arr[x][y-1] !== undefined) {
			count_alive += arr[x][y-1].life? 1 : 0;
		}
		if (arr[x+1][y-1] !== undefined) {
			count_alive += arr[x+1][y-1].life? 1 : 0;
		}
		if (arr[x-1][y] !== undefined) {
			count_alive += arr[x-1][y].life? 1 : 0;
		}
		if (arr[x+1][y] !== undefined) {
			count_alive += arr[x+1][y].life? 1 : 0;
		}
		if (arr[x-1][y+1] !== undefined) {
			count_alive += arr[x-1][y+1].life? 1 : 0;
		}
		if (arr[x][y+1] !== undefined) {
			count_alive += arr[x][y+1].life? 1 : 0;
		}
		if (arr[x+1][y+1] !== undefined) {
			count_alive += arr[x+1][y+1].life? 1 : 0;
		}

		if (arr[x][y].life) {
			if (count_alive === 3 || count_alive === 2)
				return true;
		}
		else {
			if (count_alive === 3)
				return true;
		}

		return false;
	}
	function updateObjects() {
		var orig = [[]];
		var count = 0;
		for (var x in grid) {
			var vline = [];
			for (var y in grid[x]) {
				vline.push(grid[x][y].deepCopy());
				++count;
			}
			orig.push(vline);
		}
		Debugger.log("total deep copied is " + count);
		for (var x in grid) {
			for (var y in grid[x]) {
				grid[x][y] = isAlive(orig, x, y);
			}
		}
	}
	function drawSome() {
		for (var x in grid) {
			for (var y in grid[x]) {
				grid[x][y].draw(context);
			}
		}
	}
	function drawui() {
	}
	function drawScreen () {
		context.fillStyle = bgcolor;
		context.strokeStyle = "#eeaaaa";
		context.lineWidth = 10;
		context.lineCap = 'butt';
		context.lineJoin = 'sqaure';

		context.clearRect(0,0,canvas.width,canvas.height);
		context.fillRect(0,0,canvas.width,canvas.height);
		//context.strokeRect(5,5,canvas.width-10,canvas.height-10);

		drawui();
		drawSome();
	}

	function mainloop() {
		inputProcess();
		updateObjects();
		drawScreen();
		setTimeout(mainloop, 1000/24);
	}

	initialize();
	mainloop();
}
</script>
</body>
</html>
